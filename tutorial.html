<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Tutorial &mdash; CCBlade 1.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="CCBlade 1.1.0 documentation" href="index.html" />
    <link rel="next" title="4. Module Documentation" href="documentation.html" />
    <link rel="prev" title="2. Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Module Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">CCBlade 1.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<span id="tutorial-label"></span><h1>3. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>Three examples are shown below.  The first is a complete setup for the <a class="reference internal" href="#mw-example"><em>NREL 5-MW model</em></a>, the second shows how to model blade <a class="reference internal" href="#curvature-example"><em>precurvature</em></a>, and the final shows how to get the provided <a class="reference internal" href="#gradient-example"><em>analytic gradients</em></a>.</p>
<div class="section" id="nrel-5-mw">
<span id="mw-example"></span><h2>3.1. NREL 5-MW<a class="headerlink" href="#nrel-5-mw" title="Permalink to this headline">¶</a></h2>
<p>One example of a CCBlade application is the simulation of the NREL 5-MW reference model&#8217;s aerodynamic performance.  First, define the geometry and atmospheric properties.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">ccblade</span> <span class="kn">import</span> <span class="n">CCAirfoil</span><span class="p">,</span> <span class="n">CCBlade</span>


<span class="c"># geometry</span>
<span class="n">Rhub</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">Rtip</span> <span class="o">=</span> <span class="mf">63.0</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.8667</span><span class="p">,</span> <span class="mf">5.6000</span><span class="p">,</span> <span class="mf">8.3333</span><span class="p">,</span> <span class="mf">11.7500</span><span class="p">,</span> <span class="mf">15.8500</span><span class="p">,</span> <span class="mf">19.9500</span><span class="p">,</span> <span class="mf">24.0500</span><span class="p">,</span>
              <span class="mf">28.1500</span><span class="p">,</span> <span class="mf">32.2500</span><span class="p">,</span> <span class="mf">36.3500</span><span class="p">,</span> <span class="mf">40.4500</span><span class="p">,</span> <span class="mf">44.5500</span><span class="p">,</span> <span class="mf">48.6500</span><span class="p">,</span> <span class="mf">52.7500</span><span class="p">,</span>
              <span class="mf">56.1667</span><span class="p">,</span> <span class="mf">58.9000</span><span class="p">,</span> <span class="mf">61.6333</span><span class="p">])</span>
<span class="n">chord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.542</span><span class="p">,</span> <span class="mf">3.854</span><span class="p">,</span> <span class="mf">4.167</span><span class="p">,</span> <span class="mf">4.557</span><span class="p">,</span> <span class="mf">4.652</span><span class="p">,</span> <span class="mf">4.458</span><span class="p">,</span> <span class="mf">4.249</span><span class="p">,</span> <span class="mf">4.007</span><span class="p">,</span> <span class="mf">3.748</span><span class="p">,</span>
                  <span class="mf">3.502</span><span class="p">,</span> <span class="mf">3.256</span><span class="p">,</span> <span class="mf">3.010</span><span class="p">,</span> <span class="mf">2.764</span><span class="p">,</span> <span class="mf">2.518</span><span class="p">,</span> <span class="mf">2.313</span><span class="p">,</span> <span class="mf">2.086</span><span class="p">,</span> <span class="mf">1.419</span><span class="p">])</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">13.308</span><span class="p">,</span> <span class="mf">13.308</span><span class="p">,</span> <span class="mf">13.308</span><span class="p">,</span> <span class="mf">13.308</span><span class="p">,</span> <span class="mf">11.480</span><span class="p">,</span> <span class="mf">10.162</span><span class="p">,</span> <span class="mf">9.011</span><span class="p">,</span> <span class="mf">7.795</span><span class="p">,</span>
                  <span class="mf">6.544</span><span class="p">,</span> <span class="mf">5.361</span><span class="p">,</span> <span class="mf">4.188</span><span class="p">,</span> <span class="mf">3.125</span><span class="p">,</span> <span class="mf">2.319</span><span class="p">,</span> <span class="mf">1.526</span><span class="p">,</span> <span class="mf">0.863</span><span class="p">,</span> <span class="mf">0.370</span><span class="p">,</span> <span class="mf">0.106</span><span class="p">])</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># number of blades</span>

<span class="n">tilt</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">precone</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">nSector</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c"># azimuthal discretization</span>

<span class="c"># atmosphere</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">1.225</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.81206e-5</span>

<span class="c"># power-law wind shear profile</span>
<span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">hubHt</span> <span class="o">=</span> <span class="mf">90.0</span>
</pre></div>
</div>
<p>Airfoil aerodynamic data is specified using the <a class="reference internal" href="documentation.html#ccblade.CCAirfoil" title="ccblade.CCAirfoil"><tt class="xref py py-class docutils literal"><span class="pre">CCAirfoil</span></tt></a> class.  Rather than use the default constructor, this example uses the special constructor designed to read AeroDyn files directly <a class="reference internal" href="generated/ccblade.CCAirfoil.initFromAerodynFile.html#ccblade.CCAirfoil.initFromAerodynFile" title="ccblade.CCAirfoil.initFromAerodynFile"><tt class="xref py py-meth docutils literal"><span class="pre">CCAirfoil.initFromAerodynFile()</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">afinit</span> <span class="o">=</span> <span class="n">CCAirfoil</span><span class="o">.</span><span class="n">initFromAerodynFile</span>  <span class="c"># just for shorthand</span>

<span class="c"># load all airfoils</span>
<span class="n">airfoil_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;Cylinder1.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;Cylinder2.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;DU40_A17.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;DU35_A17.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;DU30_A17.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;DU25_A17.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;DU21_A17.dat&#39;</span><span class="p">)</span>
<span class="n">airfoil_types</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">afinit</span><span class="p">(</span><span class="s">&#39;NACA64_A17.dat&#39;</span><span class="p">)</span>

<span class="c"># place at appropriate radial stations</span>
<span class="n">af_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

<span class="n">af</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
    <span class="n">af</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">airfoil_types</span><span class="p">[</span><span class="n">af_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
<p>Next, construct the CCBlade object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create CCBlade object</span>
<span class="n">rotor</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>
                <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span> <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">)</span>
</pre></div>
</div>
<p>Evaluate the distributed loads at a chosen set of operating conditions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># set conditions</span>
<span class="n">Uinf</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">tsr</span> <span class="o">=</span> <span class="mf">7.55</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="n">Uinf</span><span class="o">*</span><span class="n">tsr</span><span class="o">/</span><span class="n">Rtip</span> <span class="o">*</span> <span class="mf">30.0</span><span class="o">/</span><span class="n">pi</span>  <span class="c"># convert to RPM</span>
<span class="n">azimuth</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c"># evaluate distributed loads</span>
<span class="n">Np</span><span class="p">,</span> <span class="n">Tp</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">distributedAeroLoads</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the flapwise and lead-lag aerodynamic loading</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># plot</span>
<span class="n">rstar</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">Rhub</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Rtip</span> <span class="o">-</span> <span class="n">Rhub</span><span class="p">)</span>

<span class="c"># append zero at root and tip</span>
<span class="n">rstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">rstar</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]])</span>
<span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">Np</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]])</span>
<span class="n">Tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">Tp</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rstar</span><span class="p">,</span> <span class="n">Tp</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;lead-lag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rstar</span><span class="p">,</span> <span class="n">Np</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;flapwise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;blade fraction&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;distributed aerodynamic loads (kN)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>as shown in <a class="pageref" href="#distributed-fig">Figure  1</a>.</p>
<div class="figure align-center" id="distributed-fig">
<a class="reference internal image-reference" href="_images/distributedAeroLoads.png"><img alt="_images/distributedAeroLoads.png" src="_images/distributedAeroLoads.png" style="width: 5in;" /></a>
<p class="caption">Figure 1: Flapwise and lead-lag aerodynamic loads along blade.</p>
</div>
<p>To get the power, thrust, and torque at the same conditions (in both absolute and coefficient form), use the <a class="reference internal" href="generated/ccblade.CCBlade.evaluate.html#ccblade.CCBlade.evaluate" title="ccblade.CCBlade.evaluate"><tt class="xref py py-meth docutils literal"><span class="pre">evaluate</span></tt></a> method.  This is generally used for generating power curves so it expects <tt class="docutils literal"><span class="pre">array_like</span></tt> input.  For this example a list of size one is used.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">Uinf</span><span class="p">],</span> <span class="p">[</span><span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">pitch</span><span class="p">])</span>

<span class="n">CP</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">CQ</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">Uinf</span><span class="p">],</span> <span class="p">[</span><span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">pitch</span><span class="p">],</span> <span class="n">coefficient</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;CP =&#39;</span><span class="p">,</span> <span class="n">CP</span>
<span class="k">print</span> <span class="s">&#39;CT =&#39;</span><span class="p">,</span> <span class="n">CT</span>
<span class="k">print</span> <span class="s">&#39;CQ =&#39;</span><span class="p">,</span> <span class="n">CQ</span>
</pre></div>
</div>
<p>The result is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">CP</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.46488096</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CT</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.76926398</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CQ</span> <span class="o">=</span> <span class="p">[</span> <span class="mf">0.0616323</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that the outputs are numpy arrays (of length 1 for this example).  To generate a nondimensional power curve (<span class="math">\(\lambda\)</span> vs <span class="math">\(c_p\)</span>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># velocity has a small amount of Reynolds number dependence</span>
<span class="n">tsr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">Omega</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">tsr</span><span class="p">)</span>
<span class="n">Uinf</span> <span class="o">=</span> <span class="n">Omega</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mf">30.0</span> <span class="o">*</span> <span class="n">Rtip</span><span class="o">/</span><span class="n">tsr</span>
<span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tsr</span><span class="p">)</span>

<span class="n">CP</span><span class="p">,</span> <span class="n">CT</span><span class="p">,</span> <span class="n">CQ</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">coefficient</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsr</span><span class="p">,</span> <span class="n">CP</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;$\lambda$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$c_p$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><a class="pageref" href="#cp-fig">Figure  2</a> shows the resulting plot.</p>
<div class="figure align-center" id="cp-fig">
<a class="reference internal image-reference" href="_images/cp.png"><img alt="_images/cp.png" src="_images/cp.png" style="width: 5in;" /></a>
<p class="caption">Figure 2: Power coefficient as a function of tip-speed ratio.</p>
</div>
<p>CCBlade provides a few additional options in its constructor.  The other options are shown in the following example with their default values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create CCBlade object</span>
<span class="n">rotor</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>
                <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span> <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span>
                <span class="n">tiploss</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hubloss</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">wakerotation</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">usecd</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">iterRe</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters <tt class="code docutils literal"><span class="pre">tiploss</span></tt> and <tt class="code docutils literal"><span class="pre">hubloss</span></tt> toggle Prandtl tip and hub losses repsectively. The parameter <tt class="code docutils literal"><span class="pre">wakerotation</span></tt> toggles wake swirl (i.e., <span class="math">\(a^\prime = 0\)</span>).  The parameter <tt class="code docutils literal"><span class="pre">usecd</span></tt> can be used to disable the inclusion of drag in the calculation of the induction factors (it is always used in calculations of the distributed loads).  However, doing so may cause potential failure in the solution methodology (see <a class="reference internal" href="theory.html#ning2013a-simple-soluti" id="id1">[4]</a>).  In practice, it should work fine, but special care for that particular case has not yet been examined, and the default implementation allows for the possibility of convergence failure.  All four of these parameters are <tt class="docutils literal"><span class="pre">True</span></tt> by default.  The parameter <tt class="code docutils literal"><span class="pre">iterRe</span></tt> is for advanced usage.  Referring to <a class="reference internal" href="theory.html#ning2013a-simple-soluti" id="id2">[4]</a>, this parameter controls the number of internal iterations on the Reynolds number.  One iteration is almost always sufficient, but for high accuracy in the Reynolds number <tt class="code docutils literal"><span class="pre">iterRe</span></tt> could be set at 2.  Anything larger than that is unnecessary.</p>
</div>
<div class="section" id="precurve">
<span id="curvature-example"></span><h2>3.2. Precurve<a class="headerlink" href="#precurve" title="Permalink to this headline">¶</a></h2>
<p>CCBlade can also simulate blades with precurve.  This is done by using the <tt class="docutils literal"><span class="pre">precurve</span></tt> and <tt class="docutils literal"><span class="pre">precurveTip</span></tt> parameters.  These correspond precisely to the <tt class="docutils literal"><span class="pre">r</span></tt> and <tt class="docutils literal"><span class="pre">Rtip</span></tt> parameters.  Precurve is defined as the position of the blade reference axis in the x-direciton of the <a class="reference internal" href="csystem.html#azimuth-blade-coord"><em>blade-aligned coordinate system</em></a> (r is the position in the z-direction of the same coordinate system).  Presweep can be specified in the same manner, by using the <tt class="docutils literal"><span class="pre">presweep</span></tt> and <tt class="docutils literal"><span class="pre">presweepTip</span></tt> parameters (position in blade-aligned y-axis).  Generally, it is advsiable to set <tt class="docutils literal"><span class="pre">precone=0</span></tt> for blades with precurve.  There is no loss of generality in defining the blade shape, and including a nonzero precone would change the rotor diameter in a nonlinear way. As an example, a downwind machine with significant curvature could be simulated using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">precone</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">precurve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">4.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
<span class="n">precurveTip</span> <span class="o">=</span> <span class="mf">25.0</span>


<span class="c"># create CCBlade object</span>
<span class="n">rotor</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>
                <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span> <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">,</span>
                <span class="n">precurve</span><span class="o">=</span><span class="n">precurve</span><span class="p">,</span> <span class="n">precurveTip</span><span class="o">=</span><span class="n">precurveTip</span><span class="p">)</span>
</pre></div>
</div>
<p>The shape of the blade is seen in <a class="pageref" href="#shape-fig">Figure  3</a>.  Note that the radius of the blade is preserved because we have set the precone angle to zero.</p>
<div class="figure align-center" id="shape-fig">
<a class="reference internal image-reference" href="_images/rotorshape.png"><img alt="_images/rotorshape.png" src="_images/rotorshape.png" style="width: 5in;" /></a>
<p class="caption">Figure 3: Profile of an example (highly) precurved blade.</p>
</div>
</div>
<div class="section" id="gradients">
<span id="gradient-example"></span><h2>3.3. Gradients<a class="headerlink" href="#gradients" title="Permalink to this headline">¶</a></h2>
<p>CCBlade optinally provides analytic gradients of every output with respect to all design variables.  This is accomplished using an adjoint method (direct method is identical because there is only one state variable at each blade section).  Partial derivatives are provided by <a class="reference external" href="http://www-tapenade.inria.fr:8080/tapenade/index.jsp">Tapenade</a> and hand calculations.  Starting with the previous example for the NREL 5-MW reference model we add the keyword value <tt class="docutils literal"><span class="pre">derivatives=True</span></tt> in the constructor.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create CCBlade object</span>
<span class="n">rotor</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>
                <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span> <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now when we ask for the distributed loads, we also get the gradients.  The gradients are returned as a dictionary containing 2D arrays.  These can be accessed as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Np</span><span class="p">,</span> <span class="n">Tp</span><span class="p">,</span> <span class="n">dNp</span><span class="p">,</span> <span class="n">dTp</span> \
    <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">distributedAeroLoads</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

<span class="c"># n x n (diagonal)</span>
<span class="n">dNp_dr</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">]</span>
<span class="n">dNp_dchord</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dchord&#39;</span><span class="p">]</span>
<span class="n">dNp_dtheta</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
<span class="n">dNp_dpresweep</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dpresweep&#39;</span><span class="p">]</span>

<span class="c"># n x n (tridiagonal)</span>
<span class="n">dNp_dprecurve</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dprecurve&#39;</span><span class="p">]</span>

<span class="c"># n x 1</span>
<span class="n">dNp_dRhub</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dRhub&#39;</span><span class="p">]</span>
<span class="n">dNp_dRtip</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dRtip&#39;</span><span class="p">]</span>
<span class="n">dNp_dprecone</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span>
<span class="n">dNp_dtilt</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>
<span class="n">dNp_dhubHt</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dhubHt&#39;</span><span class="p">]</span>
<span class="n">dNp_dyaw</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dyaw&#39;</span><span class="p">]</span>
<span class="n">dNp_dazimuth</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span>
<span class="n">dNp_dUinf</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dUinf&#39;</span><span class="p">]</span>
<span class="n">dNp_dOmega</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dOmega&#39;</span><span class="p">]</span>
<span class="n">dNp_dpitch</span> <span class="o">=</span> <span class="n">dNp</span><span class="p">[</span><span class="s">&#39;dpitch&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Even though many of the matrices are diagonal, the full Jacobian is returned for consistency.  We can compare against finite differencing as follows (with a randomly chosen station along the blade):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">idx</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>

<span class="n">rotor_fd</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>
                <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span> <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-=</span> <span class="n">delta</span>

<span class="n">Npd</span><span class="p">,</span> <span class="n">Tpd</span> <span class="o">=</span> <span class="n">rotor_fd</span><span class="o">.</span><span class="n">distributedAeroLoads</span><span class="p">(</span><span class="n">Uinf</span><span class="p">,</span> <span class="n">Omega</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">)</span>

<span class="n">dNp_dr_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Npd</span> <span class="o">-</span> <span class="n">Np</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
<span class="n">dTp_dr_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tpd</span> <span class="o">-</span> <span class="n">Tp</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>

<span class="k">print</span> <span class="s">&#39;(analytic) dNp_i/dr_i =&#39;</span><span class="p">,</span> <span class="n">dNp_dr</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;(fin diff) dNp_i/dr_i =&#39;</span><span class="p">,</span> <span class="n">dNp_dr_fd</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="k">print</span>
</pre></div>
</div>
<p>The output is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">analytic</span><span class="p">)</span> <span class="n">dNp_i</span><span class="o">/</span><span class="n">dr_i</span> <span class="o">=</span> <span class="mf">107.680395098</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fin</span> <span class="n">diff</span><span class="p">)</span> <span class="n">dNp_i</span><span class="o">/</span><span class="n">dr_i</span> <span class="o">=</span> <span class="mf">107.680370762</span>
</pre></div>
</div>
<p>Similarly, when we compute thrust, torque, and power we also get the gradients (for either the nondimensional or dimensional form).  The gradients are also returned as a dictionary containing 2D Jacobians.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">dP</span><span class="p">,</span> <span class="n">dT</span><span class="p">,</span> <span class="n">dQ</span> \
    <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">Uinf</span><span class="p">],</span> <span class="p">[</span><span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">pitch</span><span class="p">])</span>

<span class="n">npts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="c"># npts x 1</span>
<span class="n">dP_dprecone</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span>
<span class="n">dP_dtilt</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>
<span class="n">dP_dhubHt</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dhubHt&#39;</span><span class="p">]</span>
<span class="n">dP_dRhub</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dRhub&#39;</span><span class="p">]</span>
<span class="n">dP_dRtip</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dRtip&#39;</span><span class="p">]</span>
<span class="n">dP_dprecurveTip</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dprecurveTip&#39;</span><span class="p">]</span>
<span class="n">dP_dpresweepTip</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dpresweepTip&#39;</span><span class="p">]</span>
<span class="n">dP_dyaw</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dyaw&#39;</span><span class="p">]</span>

<span class="c"># npts x npts</span>
<span class="n">dP_dUinf</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dUinf&#39;</span><span class="p">]</span>
<span class="n">dP_dOmega</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dOmega&#39;</span><span class="p">]</span>
<span class="n">dP_dpitch</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dpitch&#39;</span><span class="p">]</span>

<span class="c"># npts x n</span>
<span class="n">dP_dr</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dr&#39;</span><span class="p">]</span>
<span class="n">dP_dchord</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dchord&#39;</span><span class="p">]</span>
<span class="n">dP_dtheta</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
<span class="n">dP_dprecurve</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dprecurve&#39;</span><span class="p">]</span>
<span class="n">dP_dpresweep</span> <span class="o">=</span> <span class="n">dP</span><span class="p">[</span><span class="s">&#39;dpresweep&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Let us compare the derivative of power against finite differencing for one of the scalar quantities (precone):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">delta</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="o">*</span><span class="n">precone</span>
<span class="n">precone</span> <span class="o">+=</span> <span class="n">delta</span>

<span class="n">rotor_fd</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span>
    <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">precone</span> <span class="o">-=</span> <span class="n">delta</span>

<span class="n">Pd</span><span class="p">,</span> <span class="n">Td</span><span class="p">,</span> <span class="n">Qd</span> <span class="o">=</span> <span class="n">rotor_fd</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">Uinf</span><span class="p">],</span> <span class="p">[</span><span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">pitch</span><span class="p">],</span> <span class="n">coefficient</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">dT_dprecone_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Td</span> <span class="o">-</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
<span class="n">dQ_dprecone_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Qd</span> <span class="o">-</span> <span class="n">Q</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
<span class="n">dP_dprecone_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pd</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>

<span class="k">print</span> <span class="s">&#39;(analytic) dP/dprecone =&#39;</span><span class="p">,</span> <span class="n">dP_dprecone</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;(fin diff) dP/dprecone =&#39;</span><span class="p">,</span> <span class="n">dP_dprecone_fd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">analytic</span><span class="p">)</span> <span class="n">dP</span><span class="o">/</span><span class="n">dprecone</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4585.70729746</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fin</span> <span class="n">diff</span><span class="p">)</span> <span class="n">dP</span><span class="o">/</span><span class="n">dprecone</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4585.71072668</span>
</pre></div>
</div>
<p>Finally, we compare the derivative of power against finite differencing for one of the vector quantities (r) at a random index:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">idx</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="o">*</span><span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta</span>

<span class="n">rotor_fd</span> <span class="o">=</span> <span class="n">CCBlade</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">af</span><span class="p">,</span> <span class="n">Rhub</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">precone</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">yaw</span><span class="p">,</span> <span class="n">shearExp</span><span class="p">,</span>
    <span class="n">hubHt</span><span class="p">,</span> <span class="n">nSector</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">r</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-=</span> <span class="n">delta</span>

<span class="n">Pd</span><span class="p">,</span> <span class="n">Td</span><span class="p">,</span> <span class="n">Qd</span> <span class="o">=</span> <span class="n">rotor_fd</span><span class="o">.</span><span class="n">evaluate</span><span class="p">([</span><span class="n">Uinf</span><span class="p">],</span> <span class="p">[</span><span class="n">Omega</span><span class="p">],</span> <span class="p">[</span><span class="n">pitch</span><span class="p">],</span> <span class="n">coefficient</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">dT_dr_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Td</span> <span class="o">-</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
<span class="n">dQ_dr_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Qd</span> <span class="o">-</span> <span class="n">Q</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
<span class="n">dP_dr_fd</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pd</span> <span class="o">-</span> <span class="n">P</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>

<span class="k">print</span> <span class="s">&#39;(analytic) dP/dr_i =&#39;</span><span class="p">,</span> <span class="n">dP_dr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;(fin diff) dP/dr_i =&#39;</span><span class="p">,</span> <span class="n">dP_dr_fd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">analytic</span><span class="p">)</span> <span class="n">dP</span><span class="o">/</span><span class="n">dr_i</span> <span class="o">=</span> <span class="mf">848.368037506</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">fin</span> <span class="n">diff</span><span class="p">)</span> <span class="n">dP</span><span class="o">/</span><span class="n">dr_i</span> <span class="o">=</span> <span class="mf">848.355994992</span>
</pre></div>
</div>
<p>For more comprehensive comparison to finite differencing, see the unit tests contained in test/test_gradients.py.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Tutorial</a><ul>
<li><a class="reference internal" href="#nrel-5-mw">3.1. NREL 5-MW</a></li>
<li><a class="reference internal" href="#precurve">3.2. Precurve</a></li>
<li><a class="reference internal" href="#gradients">3.3. Gradients</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">2. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="documentation.html"
                        title="next chapter">4. Module Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Module Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             >previous</a> |</li>
        <li><a href="index.html">CCBlade 1.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, NREL.
      Last updated on Jan 10, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>